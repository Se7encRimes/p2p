<%--
  Created by IntelliJ IDEA.
  User: Administrator
  Date: 2017/9/14/014
  Time: 21:09
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <meta name="keywords" content="高收益理财产品,理财投资,网络投资理财平台,网贷理财,互联网金融,投资理财平台,投资理财,赚钱,小额投资理财,如何投资理财,投资理财知识,投资理财,北京p2p理财">
  <meta name="description" content="爱钱帮可以为您赚钱的网络投资理财平台，为投资理财用户和贷款用户两端提供公平、透明、安全、高效的网贷理财服务，爱钱帮互联网金融中网贷投资理财平台的最好的选择。">
  <title>爱钱帮_为您赚钱和提供高收益理财产品的理财投资投资理财平台</title>

  <meta property="og:type" content="image" />
  <meta property="og:image" content="https://www.iqianbang.com/statics/home/images/logo_brief.jpg" />

  <!--[if lt IE 9]>
  <script src="https://www.iqianbang.com/statics/newcommon/js/html5shiv.js"></script>
  <![endif]-->
  <link  rel="Shortcut  Icon"  href="https://www.iqianbang.com/statics/home/images/minilogo.png">
  <link rel="stylesheet" href="https://www.iqianbang.com/statics/newcommon/css/m2-commonNew.css?20160520">
  <link rel="stylesheet" href="https://www.iqianbang.com/statics/home2/css/m2-main.css?20160520">
  <link rel="stylesheet" href="https://www.iqianbang.com/statics/newcommon/css/m2-common.css?20160520">
  <link rel="stylesheet" href="https://www.iqianbang.com/statics/home2/styles/newreg.css?20160520">
  <script type="text/javascript" src="https://www.iqianbang.com/statics/home/js/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.iqianbang.com/statics/newcommon/js/common.js?20160520"></script>
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?af9f08105d675ef9febc0bc1ac781258";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1259164158'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1259164158%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
  </script>
  <script>
    (function(){
      var bp = document.createElement('script');
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>
  <link rel="stylesheet" href="https://www.iqianbang.com/statics/home2/styles/forget/style.css">
  <style>
    [v-cloak] {
      display: none;  }
  </style>
</head>
<body>
<!--新版header -->
<div class="m2-commonTop-con-new">
  <div class="m2-commonTop-new clearfix">
    <div class="m2-commonTop-left-new">
      <div class="m2-commonTop-tel-new">客服热线：4006-777-518</div>
    </div>
    <div class="m2-commonTop-right-new">
      <ul class="m2-commonTop-link-new">
        <li class="m2-commonTop-btn-new"><a href="/register" target="_blank">注册</a></li>
        <li class="spacer"></li>
        <li class="m2-commonTop-btn-new"><a href="/login?login_callback=/forget" target="_blank">登录</a></li>
        <li class="spacer"></li>				<li class="m2-commonTop-btn-new">
        <a href="http://wpa.b.qq.com/cgi/wpa.php?ln=1&key=XzkzODA1MzA4N180NzMzMTJfNDAwNjc3NzUxOF8yXw" target="_blank">在线客服</a>
      </li>
        <li class="spacer"></li>
        <li class="m2-commonTop-btn-new"><a class="light-color" href="/guide" target="_blank">帮助中心</a></li>
        <li class="spacer"></li>
        <li class="m2-commonTop-btn-new"><a class="light-color" href="/licaiwang_zhuantihuodong" target="_blank">活动专区</a></li>
        <li class="spacer"></li>
        <li class="m2-commonTop-btn-new"><a class="light-color" href="company_finance.html" id="cfpage">企业理财</a></li>
        <li class="spacer"></li>
        <li class="m2-commonTop-btn-new"><a href="/appdownload.html" target="_blank">手机App</a></li>
      </ul>
    </div>
  </div>
</div>
</div>
<div class="m2-commonNav-con-new">
  <div class="m2-commonNav-box-new clearfix">
    <div class="m2-commonLogo-new clearfix">
      <a class="m2-comImg-logo-new" href="/">
        <img src="https://www.iqianbang.com/statics/newcommon/images/m2-logo.png" title="爱钱帮投资理财平台logo" alt="爱钱帮标识">
      </a>
      <div class="m2-conImg-slogan-new">
        <h3>获盛大资本投资</h3>
        <h3>徽商银行存管</h3>
      </div>
    </div>
    <div class="m2-commonNav-new">
      <ul class="myacc_unlog">
        <li>
          <a href="/usercenter" class="myacc_a">
            <i class="myacc-icon"></i>
            <span class="myacc-txt">我的账户</span>
          </a>
        </li>
      </ul>             <ul class="m2-commonNavul-fir-new" data_page=''>
      <li class="m2-commonNav-fir-new li-hover"><a href="/" id="onepage">首页</a></li>
      <li class="m2-commonNav-fir-new li-hover"><a href="/touzi_licai_chanpin.html" id="twopage">我要投资</a></li>
      <li class="m2-commonNav-fir-new li-hover"><a href="/membermall.html" id="sevenpage">会员商城</a></li>
      <li class="m2-commonNav-fir-new li-hover"><a href="/anquanlicai_baozhang.html" id="fourpage">安全保障</a></li>
      <li class="m2-commonNav-fir-new li-hover"><a href="/guanyu_aiqianbang.html" id="fivepage">关于我们</a></li>
    </ul>

    </div>
  </div>
</div>
</header>
<script>
  //当前菜单
  var index = $('.m2-commonNavul-fir-new').attr('data_page');
  var $a = $('#' + index);
  var $li = $a.parent();
  $a.css('color','#fa5b2b');

  var queuename = '30017180006';
  function callback() {
    $('#tel').val($('#phonenumber').val());
    call();
  }
  setCallResponse = function (json) {
    var obj = eval('(' + json + ')');
    if (obj['description']) {
      $('#callBack-codeErr').css('display', 'block');
      $('#ivrSecurityCode').val('');
      getCode();
      setTimeout(function () {
        $('#callBack-codeErr').css('display', 'none');
      }, 3000);
    }
  }
  /**
   * 我的账户 展开收缩
   */
  function myAccountAccordion() {
    var $myAcc  = $('#threepage');
    var $accIcon = $myAcc.children('.myacc-icon');
    var $accSpan = $myAcc.children('.myacc-txt');
    var $myaccPanel = $('#myaccPanel');
    var timer;
    $myAcc.on('mouseenter mouseleave', function (e) {
      var type = e.type;
      if (type === 'mouseenter') {
        $(this).addClass('myacc-hover');
        $accIcon.addClass('myacc-icon-hover');
        $accSpan.addClass('myacc-txt-hover');
        $myaccPanel.show();
      } else {
        timer = setTimeout(function () {
          $myAcc.removeClass('myacc-hover');
          $accIcon.removeClass('myacc-icon-hover');
          $accSpan.removeClass('myacc-txt-hover');
          $myaccPanel.hide();
        },200);
      }
    });
    $myaccPanel.on('mouseenter mouseleave', function (e) {
      var type = e.type;
      if (type === 'mouseenter') {
        clearTimeout(timer);
      } else {
        $myAcc.removeClass('myacc-hover');
        $accIcon.removeClass('myacc-icon-hover');
        $accSpan.removeClass('myacc-txt-hover');
        $(this).hide();
      }
    });
  }

  myAccountAccordion();

</script>
<!-- headerEnd -->
<div class="forget" id="forget">
  <div class="forget-wrap">
    <div class="title">
      <span>找回密码</span>
    </div>
    <div v-show="!isResetStep" v-cloak>
      <div class="input-item clearfix">
        <label>手机号码</label>
        <div class="input-wrap">
          <input ref="phone" type="text" v-model="phone.value" name="phone" @focus="focus" @blur="blur">
        </div>
        <div v-show="phone.showTip" class="errorMsg" :class="{'error': phone.showError}" v-cloak>{{phone.tipText}}</div>
      </div>
      <div class="input-item clearfix">
        <label>图形验证</label>
        <div class="input-wrap">
          <input ref="code" class="short-input" v-model="code.value" type="text" name="code" @focus="focus" @blur="blur" />
          <img ref="imgcode" src="/Common-VerifyCode" @click="freshImgCode"  />
        </div>
        <div v-show="code.showTip" class="errorMsg" :class="{'error': code.showError}" v-cloak>{{code.tipText}}</div>
      </div>
      <button v-show="isLoading" class="btn mt26 ml66 btn-red" v-cloak>{{loadingText}}</button>
      <button v-show="!isLoading" class="btn mt26 ml66 btn-red" @click="sendPhoneCode" >发送手机验证码</button>
    </div>
    <div v-show="isResetStep" v-cloak>

      <div class="input-item clearfix">
        <label>手机验证</label>
        <div class="input-wrap">
          <input ref="pcode" class="short-input" v-model="pcode.value" type="text" name="pcode" @focus="focus" @blur="blur" />
        </div>
        <timer-btn class="lefttime code-btn" :disabled="false" :second="60" :cellphone="phone.value"></timer-btn>
        <div v-show="pcode.showTip" class="errorMsg" :class="{'error': pcode.showError}" v-cloak>{{pcode.tipText}}</div>
      </div>
      <div class="input-item clearfix">
        <label>新密码</label>
        <div class="input-wrap">
          <input ref="newpwd" type="password" v-model="newpwd.value" name="newpwd" @focus="focus" @blur="blur">
        </div>
        <div v-show="newpwd.showTip" class="errorMsg pwdstyle" :class="{'error': newpwd.showError}" v-cloak>{{newpwd.tipText}}</div>
      </div>
      <div class="input-item clearfix">
        <label>确认密码</label>
        <div class="input-wrap">
          <input ref="renewpwd" type="password" v-model="renewpwd.value" name="renewpwd" @focus="focus" @blur="blur">
        </div>
        <div v-show="renewpwd.showTip" class="errorMsg" :class="{'error': renewpwd.showError}" v-cloak>{{renewpwd.tipText}}</div>
      </div>
      <button v-show="isLoading" class="btn mt26 ml66 btn-red" v-cloak>{{loadingText2}}</button>
      <button v-show="!isLoading" class="btn mt26 ml66 btn-red" @click="modify" >完成修改</button>
    </div>
  </div>
  <div v-show="alertMsg" v-cloak class="mask"></div>
  <div v-show="alertMsg" v-cloak class="alertWin">
    <div class="alert-icon"></div>
    <p class="alert-msg">{{errorMsg}}</p>
    <a class="alert-ok" @click="toggleAlertWin('')" href="javascript:;">确定</a>
  </div>
</div>
<template id="timerBtn">
  <button @click="sendMsg" class="btn btn-red btn-small" :disabled="disabled || time > 0">
    {{ text }}
  </button>
</template>
<script type="text/javascript" src="https://www.iqianbang.com/statics/home2/js/vue.min.js"></script>
<script>
  var loginUrl = "/login-index.shtml";
  var FOCUS_MSG = {
    phone: '请输入手机号码',
    code: '请输入图形验证码',
    pcode: '请输入验证码',
    newpwd: '请输入8-20位字母和数字的组合密码',
    renewpwd: '请重新输入密码'
  };

  var eventHub = new Vue();

  Vue.component('timerBtn', {
    template: '#timerBtn',
    props: {
      second: {
        type: Number,
        default: 60
      },
      disabled: {
        type: Boolean,
        default: false
      },
      cellphone: {
        type: String,
        default: ''
      }
    },
    data: function () {
      return {
        time: 0
      }
    },
    methods: {
      sendMsg: function () {
        var self = this;
        var ps = {
          cellphone: this.cellphone
        }
        self.run();
        $.ajax({
          url: '/Common-sendphonewhitoutCode',
          data: ps,
          type: 'POST',
          dataType: 'json',
          success: function (data) {
            if (data) {
              if (data.status === 1) {

              } else {
                alert(data.message);
              }
            }
          },
          complete: function () {

          }
        })
      },
      run: function () {
        this.time = this.second;
        this.timer();
      },
      timer: function () {
        if (this.time > 0) {
          this.time-- ;
          setTimeout(this.timer, 1000);
        }
      }
    },
    computed: {
      text: function () {
        return this.time > 0 ? '请重新发送(' + this.time + 's)' : '重新发送';
      }
    },
    created: function () {
      eventHub.$on('runTimer',this.run);
    }
  })

  var forget = new Vue({
    el: '#forget',
    data: {
      phone: {
        value: '',
        showTip: false,
        showError: false,
        tipText: '请输入手机号码',
        valid: false
      },
      code: {
        value: '',
        showTip: false,
        showError: false,
        tipText: '请输入图形验证码',
        valid: false
      },
      isLoading: false,
      loadingText: '发送中，请稍后...',
      loadingText2: '修改中，请稍后...',
      isResetStep: false,
      pcode: {
        value: '',
        showTip: false,
        showError: false,
        tipText: '请输入验证码',
        valid: false
      },
      newpwd: {
        value: '',
        showTip: false,
        showError: false,
        tipText: '请输入8-20位字母和数字的组合密码',
        valid: false
      },
      renewpwd: {
        value: '',
        showTip: false,
        showError: false,
        tipText: '请重新输入密码',
        valid: false
      },
      alertMsg: false,
      errorMsg: ''
    },
    methods: {
      focus: function (e) {
        var target = e.target;
        var name = target.name;
        this[name].tipText = FOCUS_MSG[name];
        this[name].showError = false;
        this[name].showTip = true;
      },
      blur: function (e) {
        var target = e.target;
        var name = target.name;
        var val = target.value;
        this._valid(name, val);
      },
      _valid: function (name, val) {
        if (val) {
          if (name === 'phone') {
            if (this._isMoblie(val)) {
              this[name].valid = true;
              this[name].showTip = false;
              this[name].showError = false;
              this[name].tipText = '请输入手机号码';
            } else {
              this[name].valid = false;
              this[name].showTip = true;
              this[name].showError = true;
              this[name].tipText = '手机号码格式不正确';
            }
          }
          if (name === 'code') {
            this[name].valid = true;
            this[name].showTip = false;
            this[name].showError = false;
            this[name].tipText = '请输入图形验证码';
          }
          if (name === 'pcode') {
            this[name].valid = true;
            this[name].showTip = false;
            this[name].showError = false;
            this[name].tipText = '请输入验证码';
          }
          if (name === 'newpwd') {
            if (this._validPass(val)) {
              this[name].valid = true;
              this[name].showTip = false;
              this[name].showError = false;
            } else {
              this[name].valid = false;
              this[name].showTip = true;
              this[name].showError = true;
            }
          }
          if (name === 'renewpwd') {
            var val1 = this.$refs.newpwd.value;
            if (this._isEqual(val, val1)) {
              this[name].valid = true;
              this[name].showTip = false;
              this[name].showError = false;
            } else {
              this[name].valid = false;
              this[name].showTip = true;
              this[name].showError = true;
              this[name].tipText = '请与新密码一致';
            }
          }
        }else {
          this[name].valid = false;
          this[name].showTip = true;
          this[name].showError = true;
        }
      },
      _isMoblie: function (val) {
        return /^(13|14|15|17|18)[0-9]{9}$/.test(val);
      },
      _validPass: function (val) {
        var reg = /^(?![^a-zA-Z]+$)(?!\D+$)\S{8,20}$/;
        return reg.test(val);
      },
      _isEqual: function (val1, val2) {
        return val1 === val2;
      },
      freshImgCode: function (e) {
        var target = e.target;
        target.src = '/Common-VerifyCode?time='+Math.random();
      },
      sendPhoneCode: function (e) {
        var self = this;
        var phone = this.$refs.phone.value;
        var code = this.$refs.code.value;
        this._valid('phone', phone);
        this._valid('code', code);

        var ps = {
          cellphone: phone,
          pcode: code
        };

        if (this.phone.valid && this.code.valid) {
          this.isLoading = true;
          $.ajax({
            url: '/Common-sendphonenew',
            data: ps,
            type: 'POST',
            dataType: 'json',
            success: function (data) {
              if (data) {
                if (data.status === 1) {
                  eventHub.$emit('runTimer');
                  self.isResetStep = true;
                } else if (data.status === 0) {
                  //手机号码未注册
                  self.phone.showTip = true;
                  self.phone.showError = true;
                  self.phone.tipText = data.message;
                  self.phone.valid = false;
                } else if (data.status === -1) {
                  //验证码不对
                  self.code.showTip = true;
                  self.code.showError = true;
                  self.code.tipText = data.message;
                  self.code.valid = false;
                  self.$refs.imgcode.src = '/Common-VerifyCode?time='+Math.random();
                }
              }
            },
            complete: function () {
              self.isLoading = false;
            }
          })
        }
      },
      modify: function () {
        var self = this;
        var pcode = this.$refs.pcode.value;
        var newpwd = this.$refs.newpwd.value;
        var renewpwd = this.$refs.renewpwd.value;

        this._valid('pcode', pcode);
        this._valid('newpwd', newpwd);
        this._valid('renewpwd', renewpwd);
        if (this.pcode.valid && this.newpwd.valid && this.renewpwd.valid) {
          this.isLoading = true;
          //user_phone vcode passWord
          var ps = {
            user_phone: this.phone.value,
            vcode: this.pcode.value,
            passWord: this.newpwd.value
          };
          $.ajax({
            url: '/Common-doresetPassWordNew',
            data: ps,
            type: 'POST',
            dataType: 'json',
            success: function (data) {
              if (data) {
                if (data.status === 1) {
                  setTimeout(function () {
                    window.location.href = loginUrl;
                  },0)
                }else {
                  self.toggleAlertWin(data.message);
                }
              }
            },
            complete: function () {
              self.isLoading = false;
            }
          })
        }
      },
      toggleAlertWin: function (msg) {
        this.errorMsg = msg;
        this.alertMsg = !this.alertMsg;
      }
    },
    computed: {},
    created: function () {
      eventHub.$on('sendMsg',this.sendPhoneCode);
    }
  })

</script>
</body>
</html>
